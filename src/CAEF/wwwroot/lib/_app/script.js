var app=angular.module("caef",["angularModalService"]);!function(e){"use strict";e.controller("UsuariosController",["$scope","$location","$window","$http","ModalService",function(e,o,t,n,r){e.usuarios={},e.error="",e.roles={},e.usuarioAutenticado={},e.obtenerUsuarios=function(){n.get("/Usuarios/Usuarios").then(function(o){console.log(o.data),e.usuarios=o.data},function(o){e.error="Error al obtener usuarios: "+o})},e.obtenerRoles=function(){n.get("/CAEF/Roles").then(function(o){e.roles=o.data},function(o){e.error="Error al obtener roles: "+o})},e.editarUsuario=function(o,a){e.error="",r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/editarUsuario.html",controller:"EditarController",inputs:{usuario:o,roles:a}}).then(function(e){e.element.modal(),e.close.then(function(e){o.rol.nombre!=e.nombre&&(console.log(e),o.rolId=e.id,n.post("/Usuarios/Editar",o).then(function(e){r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){t.location="/Usuarios"})})},function(e){r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){t.location="/Usuarios"})})}))})})},e.borrarUsuario=function(o){e.error="",console.log("Quieres borrar usuario:"+o.correo),r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/borrarUsuario.html",controller:"BorrarController"}).then(function(e){e.element.modal(),e.close.then(function(e){e&&n.post("/Usuarios/Borrar",o).then(function(e){r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){t.location="/Usuarios"})})},function(e){r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){t.location="/Usuarios"})})})})})},e.obtenerUsuarioAutenticado=function(){n.get("/UsuarioActual").then(function(o){console.log(o.data),e.usuarioAutenticado=o.data,console.log(e.usuarioAutenticado)})},e.obtenerUsuarios(),e.obtenerRoles(),e.obtenerUsuarioAutenticado()}]),e.controller("BorrarController",["$scope","close",function(e,o){e.close=function(e){o(e,500)}}]),e.controller("EditarController",["$scope","$element","usuario","roles","close",function(e,o,t,n,r){console.log(t),e.usuario=t,e.rolActual=t.rol,e.listaRoles=n,e.rolSeleccionado=e.rolActual,e.accept=function(){console.log("Escogiste rol: "+e.rolSeleccionado.nombre),r(e.rolSeleccionado,500)},e.cancel=function(){console.log("Escogiste rol: "+e.rolSeleccionado.nombre),r(e.rolActual,500)}}]),e.controller("MensajeController",["$scope","mensaje","close",function(e,o,t){e.mensaje=o,e.close=function(){t(!0,500)}}]),e.controller("LoginController",["$scope","$location","$window","$http","ModalService",function(e,o,t,n,r){e.usuario={},e.returnUrl=decodeURIComponent(o.absUrl().split("ReturnUrl=")[1]),console.log(e.returnUrl),e.login=function(){console.log(e.usuario),n.post("/Login",e.usuario).then(function(o){console.log("Success"),console.log(o),t.location=e.returnUrl},function(o){console.log(o),r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){e.usuario.Password=""})})})}}]),e.controller("MenuController",["$scope","$http","$location",function(e,o,t){e.usuarioAutenticado={},e.urlActual="/"+decodeURIComponent(t.absUrl().split("/")[3]),console.log(e.urlActual),e.obtenerUsuarioAutenticado=function(){o.get("/UsuarioActual").then(function(o){e.usuarioAutenticado=o.data})},e.isActive=function(o){return o===e.urlActual},e.obtenerUsuarioAutenticado()}]),e.controller("ActasController",["$scope","$http","$location","$window","$filter","ModalService",function(e,o,t,n,r,a){e.usuarioAutenticado={},e.acta={Periodo:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2"},e.carreras=[],e.materias=[],e.subtipos=[],e.tipos=[],e.fecha=new Date,e.solicitudesAlumno=[{Alumno:{Grupo:""}}],e.grupo="",e.agregarColumna=function(){var o={Alumno:{Grupo:""}};e.solicitudesAlumno.push(o)},e.obtenerUsuarioAutenticado=function(){o.get("/UsuarioActual").then(function(o){e.usuarioAutenticado=o.data,e.acta.IdEmpleado=e.usuarioAutenticado.id})},e.obtenerCarreras=function(){o.get("/CAEF/Carreras").then(function(o){e.carreras=o.data},function(o){e.error="Error al obtener carreras: "+o})},e.obtenerMaterias=function(){o.get("/CAEF/Materias").then(function(o){e.materias=o.data},function(o){e.error="Error al obtener materias: "+o})},e.obtenerSubtipos=function(){o.get("/CAEF/Subtipos").then(function(o){e.subtipos=o.data},function(o){e.error="Error al obtener subtipos: "+o})},e.obtenerTipos=function(){o.get("/CAEF/Tipos").then(function(o){e.tipos=o.data},function(o){e.error="Error al obtener tipos: "+o})},e.calculaClaveMateria=function(){e.acta.Materia?e.acta.IdMateria=JSON.parse(e.acta.Materia).id:e.acta.IdMateria=""},e.calculaClaveCarrera=function(){e.acta.IdCarrera=JSON.parse(e.acta.Carrera).id},e.filtraMaterias=function(o){return!!e.acta.Carrera&&o.carrera===JSON.parse(e.acta.Carrera).nombre},e.grabar=function(){e.acta.IdEstado=1,e.acta.FechaCreacion=new Date,angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].Alumno.Grupo=e.grupo}),console.log(e.solicitudesAlumno),o.post("/CAEF/AgregarActaDocente",e.acta).then(function(t){console.log("Success"),console.log(t),angular.forEach(e.solicitudesAlumno,function(o,n){e.solicitudesAlumno[n].IdSolicitud=t.data}),o.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),a.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),a.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),a.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},e.obtenerUsuarioAutenticado(),e.obtenerCarreras(),e.obtenerMaterias(),e.obtenerSubtipos(),e.obtenerTipos()}]),e.controller("AgregarController",["$scope","$http","$window","$location","ModalService",function(e,o,t,n,r){e.roles={},e.usuario={},e.roles={},e.agregar=function(){console.log(e.usuario),o.post("/Usuarios/Agregar",e.usuario).then(function(e){console.log("Success"),console.log(e),r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){t.location="/Usuarios"})})},function(e){console.log(e),r.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},e.obtenerRoles=function(){o.get("/CAEF/Roles").then(function(o){e.roles=o.data},function(o){e.error="Error al obtener roles: "+o})},e.obtenerRoles()}])}(app);