app.controller("ActasController",["$rootScope","$scope","$http","$location","$window","$filter","ModalService",function(o,e,t,n,a,l,c){e.usuarioAutenticado={},e.acta={Periodo:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2",CicloEscolar:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2",ClaveUnidad:290,UnidadAcademica:"Fac. de Ingeniería, Arq. y Diseño"},e.carreras=[],e.materias=[],e.subtipos=[],e.tipos=[],e.alumnoActual=[],e.filtros={docente:"",materia:"",tipoExamen:"",periodo:"",semestre:"",estado:""},e.fecha=new Date,e.idSolicitudActual=decodeURIComponent(n.absUrl().split("/")[4]),console.log(e.idSolicitudActual),e.idSolicitudActualAlumno=[],e.solicitudesAlumno=[],e.grupo="",e.grupoA="",e.obtenerActas=function(){t.get("/Usuarios/NotificacionesDocente").then(function(o){e.actas=o.data},function(o){e.error="Error al obtener usuarios: "+o})},e.mostrarActas=function(){console.log(e.filtros),t.post("/Usuarios/Actas",e.filtros).then(function(o){console.log(o.data),e.mActas=o.data},function(o){e.error="Error al obtener usuarios: "+o})},e.mostrarActasD=function(){console.log(e.filtros),t.get("/Usuarios/ActasD").then(function(o){console.log(o.data),e.mActasD=o.data},function(o){e.error="Error al obtener usuarios: "+o})},e.revisarActaAdmin=function(){console.log(e.idSolicitudActual),t.get("/CAEF/RevisarActa/"+e.idSolicitudActual).then(function(o){e.actaActual=o.data,console.log(e.actaActual)},function(o){e.error="Error al obtener la acta: "+o})},e.verActaAdmin=function(){console.log(e.idSolicitudActual),t.get("/CAEF/VerActa/"+e.idSolicitudActual).then(function(o){e.actaActualAdmin=o.data,console.log(e.actaActualAdmin)},function(o){e.error="Error al obtener la acta: "+o})},e.obtenerAlumnosDeActas=function(){t.get("/CAEF/ObtenerAlumno/"+e.idSolicitudActual).then(function(o){e.alumnoActual=o.data,console.log(e.alumnoActual),angular.forEach(e.alumnoActual,function(o,t){e.solicitudesAlumno.push(e.alumnoActual[t])}),angular.forEach(e.solicitudesAlumno,function(o,t){e.idSolicitudActualAlumno.push(e.solicitudesAlumno[t].id)}),e.grupoA=e.alumnoActual[0].alumno.grupo},function(o){e.error="Error al obtener alumnos: "+o})},e.revisarActaDocente=function(){t.get("/Usuarios/NotificacionesDocente").then(function(o){e.actas=o.data},function(o){e.error="Error al obtener la acta: "+o})},e.inicializarAlumnosEnActa=function(){},e.agregarColumna=function(){var o={alumno:{grupo:""}};e.solicitudesAlumno.push(o)},e.removerColumna=function(){e.solicitudesAlumno.length>1&&e.solicitudesAlumno.splice(-1,1)},e.obtenerUsuarioAutenticado=function(){t.get("/UsuarioActual").then(function(o){e.usuarioAutenticado=o.data,e.acta.IdEmpleado=e.usuarioAutenticado.id})},e.obtenerCarreras=function(){t.get("/CAEF/Carreras").then(function(o){e.carreras=o.data},function(o){e.error="Error al obtener carreras: "+o})},e.obtenerMaterias=function(){t.get("/CAEF/Materias").then(function(o){e.materias=o.data},function(o){e.error="Error al obtener materias: "+o})},e.obtenerSubtipos=function(){t.get("/CAEF/Subtipos").then(function(o){e.subtipos=o.data},function(o){e.error="Error al obtener subtipos: "+o})},e.obtenerTipos=function(){t.get("/CAEF/Tipos").then(function(o){e.tipos=o.data},function(o){e.error="Error al obtener tipos: "+o})},e.calculaClaveMateria=function(){e.acta.Materia?e.acta.IdMateria=JSON.parse(e.acta.Materia).id:e.acta.IdMateria=""},e.calculaClaveMateriaActual=function(){e.actaActual.materia?e.actaActual.idMateria=JSON.parse(e.acta.Materia).id:e.actaActual.idMateria=""},e.calculaClaveCarrera=function(){e.acta.IdCarrera=JSON.parse(e.acta.Carrera).id},e.calculaClaveCarreraActual=function(){e.actaActual.idCarrera=JSON.parse(e.acta.Carrera).id},e.filtraMaterias=function(o){return!!e.acta.Carrera&&o.carrera===JSON.parse(e.acta.Carrera).nombre},e.grabarActaAdminActual=function(){e.acta.FechaAceptacion=new Date,e.acta.FechaCreacion=new Date,e.acta.NumeroAlumnos=e.solicitudesAlumno.length,e.acta.CalificacionLetra="CIEN",e.actaActual.IdEstado=2,e.acta.Comentario=e.acta.Motivo,console.log(e.actaActual),console.log(e.acta),console.log(e.solicitudesAlumno),angular.forEach(e.solicitudesAlumno,function(o,t){delete e.solicitudesAlumno[t].id}),angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].alumno.grupo=e.alumnoActual[0].alumno.grupo}),t.post("/CAEF/ObtenerIdSolicitud",e.idSolicitudActualAlumno).then(function(o){console.log("Success")},function(o){console.log(o),c.showModal({templateUrl:"views/mensajegenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})}),t.post("/CAEF/EditarActaDocente",e.actaActual).then(function(o){console.log("Success"),console.log(o),angular.forEach(e.solicitudesAlumno,function(t,n){e.solicitudesAlumno[n].IdSolicitud=o.data}),e.acta.IdSolicitud=o.data,e.acta.URLDocumento="~/Acta/"+o.data,t.post("/CAEF/AgregarActaAdmin",e.acta).then(function(o){console.log("Success"),console.log(o),t.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(o){console.log("Success"),console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){a.location="/Acta"})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},e.grabarActaAdmin=function(){e.acta.FechaAceptacion=new Date,e.acta.NumeroAlumnos=e.solicitudesAlumno.length,e.acta.CalificacionLetra="CIEN",e.acta.IdEstado=2,e.acta.FechaCreacion=new Date,e.acta.Comentario=e.acta.Motivo,angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].alumno.grupo=e.grupo}),console.log(e.acta),console.log(e.solicitudesAlumno),t.post("/CAEF/AgregarActaDocente",e.acta).then(function(o){console.log("Success"),console.log(o),angular.forEach(e.solicitudesAlumno,function(t,n){e.solicitudesAlumno[n].IdSolicitud=o.data}),e.acta.IdSolicitud=o.data,e.acta.URLDocumento="~/Acta/"+o.data,t.post("/CAEF/AgregarActaAdmin",e.acta).then(function(o){console.log("Success"),console.log(o),t.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(o){console.log("Success"),console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){a.location="/Acta"})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},e.rechazarActaAdminActual=function(){c.showModal({templateUrl:"views/rechazarActa.html",controller:"RechazarController",inputs:{actaActual:e.actaActual}}).then(function(o){o.element.modal(),o.close.then(function(o){e.actaModificada=o,e.actaModificada.IdEstado=3,null!==o&&t.post("/CAEF/EditarActaDocente",e.actaModificada).then(function(o){console.log("Success"),console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})})})},e.grabarActaDocente=function(){e.acta.IdEstado=1,e.acta.FechaCreacion=new Date,angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].alumno.grupo=e.grupo}),console.log(e.solicitudesAlumno),t.post("/CAEF/AgregarActaDocente",e.acta).then(function(o){console.log("Success"),console.log(o),angular.forEach(e.solicitudesAlumno,function(t,n){e.solicitudesAlumno[n].IdSolicitud=o.data}),t.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(o){console.log("Success"),console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){a.location="/Acta"})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},e.grabarActaDocenteActual=function(){e.acta.FechaCreacion=new Date,e.acta=e.actaActual,e.acta.IdEstado=1,console.log(e.actaActual),console.log(e.acta),console.log(e.solicitudesAlumno),angular.forEach(e.solicitudesAlumno,function(o,t){delete e.solicitudesAlumno[t].id}),angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].alumno.grupo=e.grupoA}),t.post("/CAEF/ObtenerIdSolicitud",e.idSolicitudActualAlumno).then(function(o){console.log("Success")},function(o){console.log(o),c.showModal({templateUrl:"/views/mensajegenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})}),t.post("/CAEF/EditarActaDocente",e.actaActual).then(function(o){console.log("Success"),console.log(o),angular.forEach(e.solicitudesAlumno,function(t,n){e.solicitudesAlumno[n].IdSolicitud=o.data}),t.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(o){console.log("Success"),console.log(o),c.showModal({templateUrl:"views/mensajegenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){a.location="/Acta"})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajegenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},function(o){console.log(o),c.showModal({templateUrl:"views/mensajegenerico.html",controller:"MensajeController",inputs:{mensaje:o.data}}).then(function(o){o.element.modal(),o.close.then(function(){})})})},e.mostrarActasD(),e.verActaAdmin(),e.revisarActaAdmin(),e.obtenerAlumnosDeActas(),e.inicializarAlumnosEnActa(),e.revisarActaDocente(),e.obtenerActas(),e.mostrarActas(),e.obtenerUsuarioAutenticado(),e.obtenerCarreras(),e.obtenerMaterias(),e.obtenerSubtipos(),e.obtenerTipos()}]),app.controller("RechazarController",["$scope","$element","actaActual","close",function(o,e,t,n){o.actaActual=t,o.accept=function(){n(o.actaActual,500)},o.cancel=function(){n(null,500)}}]);