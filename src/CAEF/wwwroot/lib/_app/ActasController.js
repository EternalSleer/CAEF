app.controller("ActasController",["$rootScope","$scope","$http","$location","$window","$filter","ModalService",function(e,t,o,a,n,c,l){t.usuarioAutenticado={},t.acta={Periodo:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2",CicloEscolar:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2",ClaveUnidad:290,UnidadAcademica:"Fac. de Ingeniería, Arq. y Diseño"},t.carreras=[],t.materias=[],t.subtipos=[],t.tipos=[],t.alumnoActual=[],t.filtros={docente:"",materia:"",tipoExamen:"",periodo:"",semestre:"",estado:""},t.fecha=new Date,t.idSolicitudActual=decodeURIComponent(a.absUrl().split("/")[4]),console.log(t.idSolicitudActual),t.idSolicitudActualAlumno=[],t.solicitudesAlumno=[],t.grupo="",t.grupoA="",t.obtenerActas=function(){o.get("/Usuarios/NotificacionesDocente").then(function(e){t.actas=e.data},function(e){t.error="Error al obtener usuarios: "+e})},t.mostrarActas=function(){console.log(t.filtros),o.post("/Usuarios/Actas",t.filtros).then(function(e){console.log(e.data),t.mActas=e.data},function(e){t.error="Error al obtener usuarios: "+e})},t.mostrarActasD=function(){console.log(t.filtros),o.get("/Usuarios/ActasD").then(function(e){console.log(e.data),t.mActasD=e.data},function(e){t.error="Error al obtener usuarios: "+e})},t.revisarActaAdmin=function(){console.log(t.idSolicitudActual),o.get("/CAEF/RevisarActa/"+t.idSolicitudActual).then(function(e){t.actaActual=e.data,console.log(t.actaActual)},function(e){t.error="Error al obtener la acta: "+e})},t.verActaAdmin=function(){console.log(t.idSolicitudActual),o.get("/CAEF/VerActa/"+t.idSolicitudActual).then(function(e){t.actaActualAdmin=e.data,console.log(t.actaActualAdmin)},function(e){t.error="Error al obtener la acta: "+e})},t.obtenerAlumnosDeActas=function(){o.get("/CAEF/ObtenerAlumno/"+t.idSolicitudActual).then(function(e){t.alumnoActual=e.data,console.log(t.alumnoActual),angular.forEach(t.alumnoActual,function(e,o){t.solicitudesAlumno.push(t.alumnoActual[o])}),angular.forEach(t.solicitudesAlumno,function(e,o){t.idSolicitudActualAlumno.push(t.solicitudesAlumno[o].id)}),t.grupoA=t.alumnoActual[0].alumno.grupo},function(e){t.error="Error al obtener alumnos: "+e})},t.revisarActaDocente=function(){o.get("/Usuarios/NotificacionesDocente").then(function(e){t.actas=e.data},function(e){t.error="Error al obtener la acta: "+e})},t.inicializarAlumnosEnActa=function(){},t.agregarColumna=function(){var e={alumno:{grupo:""}};t.solicitudesAlumno.push(e)},t.removerColumna=function(){t.solicitudesAlumno.length>1&&t.solicitudesAlumno.splice(-1,1)},t.obtenerUsuarioAutenticado=function(){o.get("/UsuarioActual").then(function(e){t.usuarioAutenticado=e.data,t.acta.IdEmpleado=t.usuarioAutenticado.id})},t.obtenerCarreras=function(){o.get("/CAEF/Carreras").then(function(e){t.carreras=e.data},function(e){t.error="Error al obtener carreras: "+e})},t.obtenerMaterias=function(){o.get("/CAEF/Materias").then(function(e){t.materias=e.data},function(e){t.error="Error al obtener materias: "+e})},t.obtenerSubtipos=function(){o.get("/CAEF/Subtipos").then(function(e){t.subtipos=e.data},function(e){t.error="Error al obtener subtipos: "+e})},t.obtenerTipos=function(){o.get("/CAEF/Tipos").then(function(e){t.tipos=e.data},function(e){t.error="Error al obtener tipos: "+e})},t.calculaClaveMateria=function(){t.acta.Materia?t.acta.IdMateria=JSON.parse(t.acta.Materia).id:t.acta.IdMateria=""},t.calculaClaveMateriaActual=function(){t.actaActual.materia?t.actaActual.idMateria=JSON.parse(t.acta.Materia).id:t.actaActual.idMateria=""},t.calculaClaveCarrera=function(){t.acta.IdCarrera=JSON.parse(t.acta.Carrera).id},t.calculaClaveCarreraActual=function(){t.actaActual.idCarrera=JSON.parse(t.acta.Carrera).id},t.filtraMaterias=function(e){return!!t.acta.Carrera&&e.carrera===JSON.parse(t.acta.Carrera).nombre},t.grabarActaAdminActual=function(){t.acta.FechaAceptacion=new Date,t.acta.FechaCreacion=new Date,t.acta.NumeroAlumnos=t.solicitudesAlumno.length,t.acta.CalificacionLetra="CIEN",t.actaActual.IdEstado=2,t.acta.Comentario=t.acta.Motivo,console.log(t.actaActual),console.log(t.acta),console.log(t.solicitudesAlumno),angular.forEach(t.solicitudesAlumno,function(e,o){delete t.solicitudesAlumno[o].id}),angular.forEach(t.solicitudesAlumno,function(e,o){t.solicitudesAlumno[o].alumno.grupo=t.alumnoActual[0].alumno.grupo}),o.post("/CAEF/ObtenerIdSolicitud",t.idSolicitudActualAlumno).then(function(e){console.log("Success")},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})}),o.post("/CAEF/EditarActaDocente",t.actaActual).then(function(e){console.log("Success"),console.log(e),angular.forEach(t.solicitudesAlumno,function(o,a){t.solicitudesAlumno[a].IdSolicitud=e.data}),t.acta.IdSolicitud=e.data,t.acta.URLDocumento="~/Acta/"+e.data,o.post("/CAEF/AgregarActaAdmin",t.acta).then(function(e){console.log("Success"),console.log(e),o.post("/CAEF/AgregarSolicitudAlumno",t.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},t.grabarActaAdmin=function(){t.acta.FechaAceptacion=new Date,t.acta.NumeroAlumnos=t.solicitudesAlumno.length,t.acta.CalificacionLetra="CIEN",t.acta.IdEstado=2,t.acta.FechaCreacion=new Date,t.acta.Comentario=t.acta.Motivo,angular.forEach(t.solicitudesAlumno,function(e,o){t.solicitudesAlumno[o].alumno.grupo=t.grupo}),console.log(t.acta),console.log(t.solicitudesAlumno),o.post("/CAEF/AgregarActaDocente",t.acta).then(function(e){console.log("Success"),console.log(e),angular.forEach(t.solicitudesAlumno,function(o,a){t.solicitudesAlumno[a].IdSolicitud=e.data}),t.acta.IdSolicitud=e.data,t.acta.URLDocumento="~/Acta/"+e.data,o.post("/CAEF/AgregarActaAdmin",t.acta).then(function(e){console.log("Success"),console.log(e),o.post("/CAEF/AgregarSolicitudAlumno",t.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},t.rechazarActaAdminActual=function(){l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/rechazarActa.html",controller:"RechazarController",inputs:{actaActual:t.actaActual}}).then(function(e){e.element.modal(),e.close.then(function(e){t.actaModificada=e,t.actaModificada.IdEstado=3,null!==e&&o.post("/CAEF/EditarActaDocente",t.actaModificada).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})})})},t.grabarActaDocente=function(){t.acta.IdEstado=1,t.acta.FechaCreacion=new Date,angular.forEach(t.solicitudesAlumno,function(e,o){t.solicitudesAlumno[o].alumno.grupo=t.grupo}),console.log(t.solicitudesAlumno),o.post("/CAEF/AgregarActaDocente",t.acta).then(function(e){console.log("Success"),console.log(e),angular.forEach(t.solicitudesAlumno,function(o,a){t.solicitudesAlumno[a].IdSolicitud=e.data}),o.post("/CAEF/AgregarSolicitudAlumno",t.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},t.grabarActaDocenteActual=function(){t.acta.FechaCreacion=new Date,t.acta=t.actaActual,t.acta.IdEstado=1,console.log(t.actaActual),console.log(t.acta),console.log(t.solicitudesAlumno),angular.forEach(t.solicitudesAlumno,function(e,o){delete t.solicitudesAlumno[o].id}),angular.forEach(t.solicitudesAlumno,function(e,o){t.solicitudesAlumno[o].alumno.grupo=t.grupoA}),o.post("/CAEF/ObtenerIdSolicitud",t.idSolicitudActualAlumno).then(function(e){console.log("Success")},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})}),o.post("/CAEF/EditarActaDocente",t.actaActual).then(function(e){console.log("Success"),console.log(e),angular.forEach(t.solicitudesAlumno,function(o,a){t.solicitudesAlumno[a].IdSolicitud=e.data}),o.post("/CAEF/AgregarSolicitudAlumno",t.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"https://caefuabc.azurewebsites.net/views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},t.mostrarActasD(),t.verActaAdmin(),t.revisarActaAdmin(),t.obtenerAlumnosDeActas(),t.inicializarAlumnosEnActa(),t.revisarActaDocente(),t.obtenerActas(),t.mostrarActas(),t.obtenerUsuarioAutenticado(),t.obtenerCarreras(),t.obtenerMaterias(),t.obtenerSubtipos(),t.obtenerTipos()}]),app.controller("RechazarController",["$scope","$element","actaActual","close",function(e,t,o,a){e.actaActual=o,e.accept=function(){a(e.actaActual,500)},e.cancel=function(){a(null,500)}}]);