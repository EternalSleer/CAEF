app.controller("ActasController",["$scope","$http","$location","$window","$filter","ModalService",function(e,o,t,n,a,l){e.usuarioAutenticado={},e.acta={Periodo:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2",CicloEscolar:(new Date).getMonth()<5?(new Date).getFullYear()+"-1":(new Date).getFullYear()+"-2",ClaveUnidad:290,UnidadAcademica:"Fac. de Ingeniería, Arq. y Diseño"},e.carreras=[],e.materias=[],e.subtipos=[],e.tipos=[],e.fecha=new Date,e.solicitudesAlumno=[{Alumno:{Grupo:""}}],e.grupo="",e.agregarColumna=function(){var o={Alumno:{Grupo:""}};e.solicitudesAlumno.push(o)},e.removerColumna=function(){e.solicitudesAlumno.length>1&&e.solicitudesAlumno.splice(-1,1)},e.obtenerUsuarioAutenticado=function(){o.get("/UsuarioActual").then(function(o){e.usuarioAutenticado=o.data,e.acta.IdEmpleado=e.usuarioAutenticado.id})},e.obtenerCarreras=function(){o.get("/CAEF/Carreras").then(function(o){e.carreras=o.data},function(o){e.error="Error al obtener carreras: "+o})},e.obtenerMaterias=function(){o.get("/CAEF/Materias").then(function(o){e.materias=o.data},function(o){e.error="Error al obtener materias: "+o})},e.obtenerSubtipos=function(){o.get("/CAEF/Subtipos").then(function(o){e.subtipos=o.data},function(o){e.error="Error al obtener subtipos: "+o})},e.obtenerTipos=function(){o.get("/CAEF/Tipos").then(function(o){e.tipos=o.data},function(o){e.error="Error al obtener tipos: "+o})},e.calculaClaveMateria=function(){e.acta.Materia?e.acta.IdMateria=JSON.parse(e.acta.Materia).id:e.acta.IdMateria=""},e.calculaClaveCarrera=function(){e.acta.IdCarrera=JSON.parse(e.acta.Carrera).id},e.filtraMaterias=function(o){return!!e.acta.Carrera&&o.carrera===JSON.parse(e.acta.Carrera).nombre},e.grabarActaAdmin=function(){e.acta.FechaAceptacion=new Date,e.acta.NumeroAlumnos=e.solicitudesAlumno.length,e.acta.CalificacionLetra="CIEN",e.acta.IdEstado=2,e.acta.FechaCreacion=new Date,e.acta.Comentario=e.acta.Motivo,angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].alumno.grupo=e.grupo}),console.log(e.acta),console.log(e.solicitudesAlumno),o.post("/CAEF/AgregarActaDocente",e.acta).then(function(t){console.log("Success"),console.log(t),angular.forEach(e.solicitudesAlumno,function(o,n){e.solicitudesAlumno[n].IdSolicitud=t.data}),e.acta.IdSolicitud=t.data,e.acta.URLDocumento="~/Acta/"+t.data,o.post("/CAEF/AgregarActaAdmin",e.acta).then(function(t){console.log("Success"),console.log(t),o.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},e.grabarActaDocente=function(){e.acta.IdEstado=1,e.acta.FechaCreacion=new Date,angular.forEach(e.solicitudesAlumno,function(o,t){e.solicitudesAlumno[t].Alumno.Grupo=e.grupo}),console.log(e.solicitudesAlumno),o.post("/CAEF/AgregarActaDocente",e.acta).then(function(t){console.log("Success"),console.log(t),angular.forEach(e.solicitudesAlumno,function(o,n){e.solicitudesAlumno[n].IdSolicitud=t.data}),o.post("/CAEF/AgregarSolicitudAlumno",e.solicitudesAlumno).then(function(e){console.log("Success"),console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){n.location="/Acta"})})},function(e){console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},function(e){console.log(e),l.showModal({templateUrl:"views/mensajeGenerico.html",controller:"MensajeController",inputs:{mensaje:e.data}}).then(function(e){e.element.modal(),e.close.then(function(){})})})},e.obtenerUsuarioAutenticado(),e.obtenerCarreras(),e.obtenerMaterias(),e.obtenerSubtipos(),e.obtenerTipos()}]);